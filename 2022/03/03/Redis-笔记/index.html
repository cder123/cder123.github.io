<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Redis-笔记 | Cyw的笔记栈</title><meta name="keywords" content="Redis"><meta name="author" content="CYW"><meta name="copyright" content="CYW"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="Redis-笔记      零、参考资料 Redis 6-尚硅谷版 Redis 6 -尚硅谷版-博客 Redis 6-笔记  一、Redis 的安装1、安装步骤1、安装GCC环境： 123yum install gccgcc --vserion    2、上传 Redis的压缩包 到&#x2F;opt&#x2F;目录下 3、解压 Redis的压缩包： 1tar -zxvf 压缩包名    4、进入解压后的目录，编译并">
<meta property="og:type" content="article">
<meta property="og:title" content="Redis-笔记">
<meta property="og:url" content="http://cder123.github.io/2022/03/03/Redis-%E7%AC%94%E8%AE%B0/index.html">
<meta property="og:site_name" content="Cyw的笔记栈">
<meta property="og:description" content="Redis-笔记      零、参考资料 Redis 6-尚硅谷版 Redis 6 -尚硅谷版-博客 Redis 6-笔记  一、Redis 的安装1、安装步骤1、安装GCC环境： 123yum install gccgcc --vserion    2、上传 Redis的压缩包 到&#x2F;opt&#x2F;目录下 3、解压 Redis的压缩包： 1tar -zxvf 压缩包名    4、进入解压后的目录，编译并">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://z3.ax1x.com/2021/06/01/2KV1yj.png">
<meta property="article:published_time" content="2022-03-03T09:47:54.209Z">
<meta property="article:modified_time" content="2022-07-28T11:26:25.471Z">
<meta property="article:author" content="CYW">
<meta property="article:tag" content="Redis">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://z3.ax1x.com/2021/06/01/2KV1yj.png"><link rel="shortcut icon" href="https://z3.ax1x.com/2021/06/01/2KeKMQ.png"><link rel="canonical" href="http://cder123.github.io/2022/03/03/Redis-%E7%AC%94%E8%AE%B0/"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: {"path":"search.xml","languages":{"hits_empty":"找不到您查询的内容：${query}"}},
  translate: {"defaultEncoding":2,"translateDelay":0,"msgToTraditionalChinese":"简","msgToSimplifiedChinese":"繁"},
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  date_suffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'mediumZoom',
  Snackbar: undefined,
  source: {
    jQuery: 'https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js',
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/justifiedGallery/dist/js/jquery.justifiedGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/justifiedGallery/dist/css/justifiedGallery.min.css'
    },
    fancybox: {
      js: 'https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js',
      css: 'https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: true,
  isanchor: true
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'Redis-笔记',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2022-07-28 19:26:25'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          if (t === 'dark') activateDarkMode()
          else if (t === 'light') activateLightMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const fontSizeVal = saveToLocal.get('global-font-size')
    if (fontSizeVal !== undefined) {
      document.documentElement.style.setProperty('--global-font-size', fontSizeVal + 'px')
    }
    })(window)</script><meta name="generator" content="Hexo 5.4.0"></head><body><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="author-avatar"><img class="avatar-img" src= "data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="https://z3.ax1x.com/2021/06/01/2KZgDs.png" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="site-data"><div class="data-item is-center"><div class="data-item-link"><a href="/archives/"><div class="headline">文章</div><div class="length-num">73</div></a></div></div><div class="data-item is-center"><div class="data-item-link"><a href="/tags/"><div class="headline">标签</div><div class="length-num">29</div></a></div></div><div class="data-item is-center"><div class="data-item-link"><a href="/categories/"><div class="headline">分类</div><div class="length-num">55</div></a></div></div></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 主页</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 归档</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('https://z3.ax1x.com/2021/06/01/2KV1yj.png')"><nav id="nav"><span id="blog_name"><a id="site-name" href="/">Cyw的笔记栈</a></span><div id="menus"><div id="search-button"><a class="site-page social-icon search"><i class="fas fa-search fa-fw"></i><span> 搜索</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 主页</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 归档</span></a></div></div><div id="toggle-menu"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">Redis-笔记<a class="post-edit-link" href="null_posts/Redis-笔记.md" title="编辑" target="_blank"><i class="fas fa-pencil-alt"></i></a></h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2022-03-03T09:47:54.209Z" title="发表于 2022-03-03 17:47:54">2022-03-03</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2022-07-28T11:26:25.471Z" title="更新于 2022-07-28 19:26:25">2022-07-28</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E5%90%8E%E7%AB%AF/">后端</a><i class="fas fa-angle-right post-meta-separator"></i><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E5%90%8E%E7%AB%AF/Java/">Java</a><i class="fas fa-angle-right post-meta-separator"></i><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/SQL/">SQL</a><i class="fas fa-angle-right post-meta-separator"></i><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/SQL/Redis/">Redis</a><i class="fas fa-angle-right post-meta-separator"></i><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E5%90%8E%E7%AB%AF/Java/Redis/">Redis</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">字数总计:</span><span class="word-count">8.3k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">阅读时长:</span><span>33分钟</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="Redis-笔记"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><h1>Redis-笔记</h1>





<h1 id="零、参考资料"><a href="#零、参考资料" class="headerlink" title="零、参考资料"></a>零、参考资料</h1><ul>
<li><a target="_blank" rel="noopener" href="https://www.bilibili.com/video/BV1Rv41177Af?p=2">Redis 6-尚硅谷版</a></li>
<li><a target="_blank" rel="noopener" href="https://zhangc233.github.io/2021/05/02/Redis/">Redis 6 -尚硅谷版-博客</a></li>
<li><a target="_blank" rel="noopener" href="https://blog.csdn.net/weixin_47872288/article/details/118410080">Redis 6-笔记</a></li>
</ul>
<h1 id="一、Redis-的安装"><a href="#一、Redis-的安装" class="headerlink" title="一、Redis 的安装"></a>一、Redis 的安装</h1><h2 id="1、安装步骤"><a href="#1、安装步骤" class="headerlink" title="1、安装步骤"></a>1、安装步骤</h2><p>1、安装GCC环境：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">yum install gcc</span><br><span class="line"></span><br><span class="line">gcc --vserion</span><br></pre></td></tr></table></figure>



<p>2、上传 <strong>Redis的压缩包</strong> 到<code>/opt/</code>目录下</p>
<p>3、解压 <strong>Redis的压缩包</strong>：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tar -zxvf 压缩包名</span><br></pre></td></tr></table></figure>



<p>4、进入解压后的目录，编译并安装：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">cd 压缩包名</span><br><span class="line"></span><br><span class="line">make</span><br><span class="line"></span><br><span class="line">make install</span><br></pre></td></tr></table></figure>



<p>5、安装完毕（默认安装在<code>/usr/local/bin/</code>目录下）</p>
<p><font color=red>注意：</font></p>
<p>此时，Redis有两个主要的目录，一个是解压目录（<code>/opt/redis-6.2.2/</code>），一个是安装目录<code>/usr/local/bin/</code>。</p>
<h2 id="2、安装过程中可能出现的报错"><a href="#2、安装过程中可能出现的报错" class="headerlink" title="2、安装过程中可能出现的报错"></a>2、安装过程中可能出现的报错</h2><p>问题：</p>
<blockquote>
<p>若没有准备好C语言的编译环境，make编译时，会产生<code>–Jemalloc/jemalloc.h：没有那个文件</code>的报错。</p>
</blockquote>
<p>解决：</p>
<blockquote>
<p>在<code>/opt/redis解压目录/</code>目录下， 执行命令<code>make distclean</code></p>
</blockquote>
<h2 id="3、Redis-安装目录介绍"><a href="#3、Redis-安装目录介绍" class="headerlink" title="3、Redis 安装目录介绍"></a>3、Redis 安装目录介绍</h2><table>
<thead>
<tr>
<th align="center">目录名</th>
<th align="left">说明</th>
</tr>
</thead>
<tbody><tr>
<td align="center"><code>redis-benchmark</code></td>
<td align="left">性能测试工具</td>
</tr>
<tr>
<td align="center"><code>redis-check-aop</code></td>
<td align="left">修复AOP文件</td>
</tr>
<tr>
<td align="center"><code>redis-check-dump</code></td>
<td align="left">修复dump.rdb文件</td>
</tr>
<tr>
<td align="center"><code>redis-sentinel</code></td>
<td align="left">redis集群使用</td>
</tr>
<tr>
<td align="center"><code>redis-server</code></td>
<td align="left">Redis服务器启动命令</td>
</tr>
<tr>
<td align="center"><code>redis-cli</code></td>
<td align="left">客户端，操作入口</td>
</tr>
</tbody></table>
<h2 id="4、Redis-启动服务端步骤"><a href="#4、Redis-启动服务端步骤" class="headerlink" title="4、Redis 启动服务端步骤"></a>4、Redis 启动服务端步骤</h2><p>Redis有 <strong>前台启动</strong> 和 <strong>后台启动</strong> 两种。前台启动就是shell窗口不能关；后台启动就是后台默默运行。</p>
<p>推荐使用Redis的后台启动。</p>
<p>1、备份<code>redis.conf</code>文件：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 进入redis的解压目录</span></span><br><span class="line">cd /opt/redis-6.2.6/</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 将redis.conf 文件备份到 /etc目录下</span></span><br><span class="line">cp ./redis.conf /etc/redis.conf</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<p>2、将<code>/etc/redis.conf</code> 文件(128行)中的<code>daemonize no</code>改为<code>yes</code></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">vi /etc/redis.conf</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 找到 daemonize 所在的行，输入 i 进入插入模式，将no改为yes</span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 按 esc 键，输入 :wq 保存</span></span><br></pre></td></tr></table></figure>



<p>3、进入redis的安装目录<code>/usr/local/bin/</code>，启动：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 进入redis的安装目录</span></span><br><span class="line">cd /usr/local/bin</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 启动redis的服务端，并指定配置文件（刚才备份到了 /etc 目录下）</span></span><br><span class="line">redis-server /etc/redis.conf</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 查看是否启动成功</span></span><br><span class="line">ps -ef | grep redis</span><br></pre></td></tr></table></figure>



<img src= "data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="https://cyw-imgbed.oss-cn-hangzhou.aliyuncs.com/img/image-20220302174936819.png"/>





<h2 id="5、Redis-启动客户端步骤"><a href="#5、Redis-启动客户端步骤" class="headerlink" title="5、Redis 启动客户端步骤"></a>5、Redis 启动客户端步骤</h2><p>进入redis的安装目录，执行启动redis客户端的命令：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">cd /usr/local/bin/</span><br><span class="line"></span><br><span class="line">redis-cli</span><br></pre></td></tr></table></figure>





<h2 id="6、Redis-关闭客户端步骤"><a href="#6、Redis-关闭客户端步骤" class="headerlink" title="6、Redis 关闭客户端步骤"></a>6、Redis 关闭客户端步骤</h2><p>Redis关闭客户端有三种方式。</p>
<blockquote>
<p>单例关闭：</p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">redis-cli shutdown</span><br></pre></td></tr></table></figure>



<blockquote>
<p>进入终端关闭：</p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">shutdown</span><br></pre></td></tr></table></figure>



<blockquote>
<p>多例关闭：</p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">redis-cli -p 6379 shutdown</span><br></pre></td></tr></table></figure>





<h2 id="7、Redis-相关知识的介绍"><a href="#7、Redis-相关知识的介绍" class="headerlink" title="7、Redis 相关知识的介绍"></a>7、Redis 相关知识的介绍</h2><p>Redis的端口是<code>6379</code>，默认有<code>16</code>个数据库（编号0~15），默认0号库。</p>
<p>redis 基于key-value。</p>
<p>redis 具有统一的密码管理（所有库的密码都相同）。</p>
<p>reids 是单线程 + 多路IO复用技术。</p>
<p>redis 与 Memcache 的不同：数据类型更多、支持持久化、单线程+IO复用</p>
<p>切换数据库：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select 数据库编号</span><br></pre></td></tr></table></figure>



<p>查看当前数据库的key数：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dbsize</span><br></pre></td></tr></table></figure>



<p>清空库：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">flushdb</span><br></pre></td></tr></table></figure>





<p>清空所有库：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">flushall</span><br></pre></td></tr></table></figure>









<h1 id="二、Redis-常用数据类型"><a href="#二、Redis-常用数据类型" class="headerlink" title="二、Redis 常用数据类型"></a>二、Redis 常用数据类型</h1><h2 id="1、通用的操作"><a href="#1、通用的操作" class="headerlink" title="1、通用的操作"></a>1、通用的操作</h2><p>常用操作：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 切换redis数据库,redis默认有16个数据库，编号为0~15</span></span><br><span class="line">select 数据库编号</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 查看当前的数据库有多少key</span></span><br><span class="line">dbsize</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 清空当前库</span></span><br><span class="line">flushdb</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 清空所有库</span></span><br><span class="line">flushall</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 查看当前库中的所有key</span></span><br><span class="line">keys *</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 判断某个key是否存在</span></span><br><span class="line">exits 键名</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 判断key 的数据类型</span></span><br><span class="line">type 键名</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 删除指定的key及其对应的数据</span></span><br><span class="line">del 键名</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 根据value值选择非阻塞删除，仅将keys从keyspace元数据中删除，真正的删除会在后续的异步操作</span></span><br><span class="line">unlink 键名</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 给某个key设定过期时长</span></span><br><span class="line">expire 键名 秒数</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 查看还有多少秒过期，-1表示永不过期，-2表示已过期</span></span><br><span class="line">ttl 键名</span><br></pre></td></tr></table></figure>









<p>Redis 常用的五大数据类型：</p>
<blockquote>
<ul>
<li><code>string</code></li>
<li><code>list</code></li>
<li><code>set</code></li>
<li><code>zset</code></li>
<li><code>hash</code></li>
</ul>
</blockquote>
<h2 id="2、string-类型"><a href="#2、string-类型" class="headerlink" title="2、string 类型"></a>2、string 类型</h2><p>string 类型是 redis 的一个基本类型，一个 key 对应一个 value 。每个value最大为 <code>512 MB</code>。</p>
<p>string 类型是 <code>二进制安全</code>的，可以包含任何数据，如：图片、序列化对象。</p>
<p>常用命令：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 设置/修改数据</span></span><br><span class="line">set 键名 值</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 读取数据</span></span><br><span class="line">get 键名</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 追加数据,没有键则新建，有键则追加到原数据的末尾</span></span><br><span class="line">append 键名 值</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 获取键所对应的value的长度</span></span><br><span class="line">strlen 键名</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 只有不存在key时，才设置键值对</span></span><br><span class="line">setnx 键名 值</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 让数值value自增1（只有是数值时才生效）,若为空，则设置后为1</span></span><br><span class="line">incr 键名</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 让数值value自减1（只有是数值时才生效）,若为空，则设置后为1</span></span><br><span class="line">decr 键名</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 指定步长的自增</span></span><br><span class="line">incrby 键名 步长</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 指定步长的自减</span></span><br><span class="line">decrby 键名 步长</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 一次性设置多个key-value</span></span><br><span class="line">mset 键名1 值1 键名2 值2</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 一次性获取多个key-value</span></span><br><span class="line">mget 键名1 键名2</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 当所指定的key不存在的时候，一次性设置多个key-value</span></span><br><span class="line">msetnx 键名1 值1 键名2 值2</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 截取子串，类型Java中的substring()函数，左右均包括</span></span><br><span class="line">getrange 键名 开始下标 结束下标</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 设置key-value的同时指定过期时间</span></span><br><span class="line">setex 键名 过期时间 值</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 以新换旧，获取旧值、设置新值</span></span><br><span class="line">getset 键名 新值</span><br></pre></td></tr></table></figure>



<p>原子性：不会被线程调度打断。单线程时，都是原子操作；多线程时，不被多线程打断操作的就是原子性。（一个失败，则全部失败）</p>
<p>Redis的原子性得益于Redis的单线程。</p>
<p>string 类型就是一个简单动态字符串（SDS），类型Java中ArrayList的效果。</p>
<p>string 内部的数据小于<code>1 MB</code>时，翻倍扩容；数据大于<code>1 MB</code>时，每次最多扩容<code>1 MB</code>。最大长度<code>512 MB</code>。</p>
<h2 id="3、list-类型"><a href="#3、list-类型" class="headerlink" title="3、list 类型"></a>3、list 类型</h2><p>list 类型是<code>单键多值</code>，一个键多个值。在底层使用的是双向链表，因此可以在任意位置进行插入和删除。</p>
<p>list 列表元素较少时，使用空间连续的<strong>压缩列表</strong><code>ziplist</code>，</p>
<p>list 列表元素较少时，使用空间连续的<strong>压缩列表</strong><code>ziplist</code>，</p>
<p>常用命令：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 查看连续的多个数据，结束下标=-1时，表示开始下标到最后一个元素</span></span><br><span class="line">lrange 键名 开始下标 结束下标</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> (从左边开始)按下标查看列表的元素</span></span><br><span class="line">lindex 键名 下标</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 获取列表长度</span></span><br><span class="line">llen 键名</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 从左边插入</span></span><br><span class="line">lpush 键名1 值1 键名2 值2</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 从右边插入</span></span><br><span class="line">rpush 键名1 值1 键名2 值2</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 从左边删除（list左边的1个值），可以在命令最后指定要删除的元素个数</span></span><br><span class="line">lpop 键名</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 从右边删除（list右边的1个值）</span></span><br><span class="line">rpop 键名</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> list1右边的数据移到list1左边</span></span><br><span class="line">rpoplpush list1的键名 list2的键名</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 在第一个指定值的（前面brfore|后边after）插入新值</span></span><br><span class="line">linsert 键名 before 指定值 新值</span><br><span class="line">linsert 键名 after 指定值 新值</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 从左边删除n个指定值</span></span><br><span class="line">lrem 键名 n 指定值</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 替换指定下标的值</span></span><br><span class="line">lset 键名 下标 新值</span><br></pre></td></tr></table></figure>









<h2 id="4、set-类型"><a href="#4、set-类型" class="headerlink" title="4、set 类型"></a>4、set 类型</h2><p>set 类型是一个可去重的 <code>string</code>类型的<strong>无序集合</strong>。</p>
<p>set 类型的底层是<code> value为 null 的 hash 表</code>，所以其增删改查的复杂度都是<code>O(1)</code></p>
<p>常用操作：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 添加多个值到<span class="built_in">set</span>集合中</span></span><br><span class="line">sadd 键 值1 值2</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 删除<span class="built_in">set</span>集合中指定的元素</span></span><br><span class="line">srem 键 值1 值2</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 随机删除<span class="built_in">set</span>集合中的一个值</span></span><br><span class="line">spop 键</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 取出<span class="built_in">set</span>集合中的所有值</span></span><br><span class="line">smembers 键</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 随机查询<span class="built_in">set</span>集合中的n个值（不会删除）</span></span><br><span class="line">srandmember 键 n</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 判断指定的<span class="built_in">set</span>集合中是否存在该值,存在：1 ；不存在：0</span></span><br><span class="line">sismember 键 值</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 返回<span class="built_in">set</span>集合中的元素个数</span></span><br><span class="line">scard 键</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 将值从源<span class="built_in">set</span>集合移动到目标集合</span></span><br><span class="line">smove src的key dst的key 值</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 返回两个集合的交集</span></span><br><span class="line">sinter 键1 键2</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 返回两个集合的并集</span></span><br><span class="line">sunion 键1 键2</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 返回两个集合的差集</span></span><br><span class="line">sdiff 键1 键2</span><br></pre></td></tr></table></figure>







<h2 id="5、hash-类型"><a href="#5、hash-类型" class="headerlink" title="5、hash 类型"></a>5、hash 类型</h2><p>hash 类型对应的数据结构：压缩列表<code>ziplist</code>、哈希表<code>hashtable</code>。</p>
<p><code>field-value</code>长度较短、且数量较少时，使用 <code>ziplist</code>。否则，使用 <code>hashtable</code>。</p>
<img src= "data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="https://cyw-imgbed.oss-cn-hangzhou.aliyuncs.com/img/image-20220304191813669.png"/>

<center>hash 结构</center>



<p>常用操作：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 添加数据（<span class="built_in">hash</span>的数据部分是哈希表，field相当于数据部分的哈希表的键）</span></span><br><span class="line">hset 键 字段 值</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 获取数据</span></span><br><span class="line">hget 键 字段</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 设置<span class="built_in">hash</span>表数据部分的多个值</span></span><br><span class="line">hmset  键 字段1 值1 字段2 值2</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 设置<span class="built_in">hash</span>表数据部分的多个值</span></span><br><span class="line">hexists  键 字段</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 获取指定的<span class="built_in">hash</span>表所有的字段</span></span><br><span class="line">hkeys  键</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 获取指定的<span class="built_in">hash</span>表中所有的值</span></span><br><span class="line">hvals  键</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 给指定的<span class="built_in">hash</span>表中指定的字段所对应的值增加指定的增量</span></span><br><span class="line">hincrby 键 字段 增量</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 当指定的字段不存在时，添加值</span></span><br><span class="line">hsetnx 键 字段 值</span><br></pre></td></tr></table></figure>







<h2 id="6、zset-类型"><a href="#6、zset-类型" class="headerlink" title="6、zset 类型"></a>6、zset 类型</h2><p>zset 类型的<strong>没有重复元素有序集合</strong>，是元素均为字符串。</p>
<p>zset 集合的每个成员都关联的一个<font color=red>评分（score）</font>，按 “评分” <strong>升序</strong>将集合的的元素排列。</p>
<p>zset 集合的成员不能重复，<font color=red>但“评分”可以重复</font>。</p>
<p>因为元素是有序的，所以可以很快根据 “评分” 、“次序”来获取一个范围的元素。</p>
<p>在底层使用<code>跳跃表</code>实现，既有红黑树的效率，又比红黑树实现起来简单。</p>
<p>常用操作：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 添加元素</span></span><br><span class="line">zadd 键 评分 值1 值2 值3</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 返回范围在[起始下标 , 终止下标]之间的元素,若结尾有withscores，表示返回：评分+值</span></span><br><span class="line">zrange 键 起始下标 终止下标 withscores</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 返回zset集合中，所有score值在[min,max]之间的集合值，按score升序排列(最大值后的参数可省略)</span></span><br><span class="line">zrangebyscore 键 评分的最小值 评分的最大值 withscore limit 偏移量 个数</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash">返回zset集合中，所有score值在[min,max]之间的集合值，按score降序排列(最大值后的参数可省略)</span></span><br><span class="line">zrevrangebyscore 键 评分的最小值 评分的最大值 withscore limit 偏移量 个数</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 给元素的score评分加上增量</span></span><br><span class="line">zincrby 键 增量 值</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 删除指定的元素</span></span><br><span class="line">zrem 键 值</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 统计zset集合内，score在 [min,max]内的元素个数</span></span><br><span class="line">zcount 键 最小值 最大值</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 返回该值在集合中的排名，从0开始</span></span><br><span class="line">zrank 键 值</span><br></pre></td></tr></table></figure>



<iframe style="height:600px;"  src="//player.bilibili.com/player.html?aid=247670776&bvid=BV1Rv41177Af&cid=326379063&page=12" scrolling="no" border="0" frameborder="no" framespacing="0" allowfullscreen="true"> </iframe>





<h2 id="7、bitmaps-类型"><a href="#7、bitmaps-类型" class="headerlink" title="7、bitmaps 类型"></a>7、bitmaps 类型</h2><p>常用于统计用户的访问量。</p>
<p>活跃的用户越多，（相比 set 类型）使用 bitmaps 来统计活跃用户就越省空间。</p>
<ul>
<li><p>bitmaps 类型 本质上还是字符串类型，但可以对字符串中的<code>位</code>进行操作。</p>
</li>
<li><p>bitmaps 类型 单独提供了一套命令，所以在 Redis 中使用bitmaps和使用字符串的命令有所不同。</p>
</li>
<li><p>可以把 bitmaps 类型 看作是以<code>bit 位</code>为单位的数组，数组的每个单元都只能存储 0 和 1，数组的下标在 bitmaps 类型中叫<font style="color:purple;">偏移量</font>。</p>
</li>
</ul>
<img src= "data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="https://cyw-imgbed.oss-cn-hangzhou.aliyuncs.com/img/image-20220307182133578.png"/>



<img src= "data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="https://cyw-imgbed.oss-cn-hangzhou.aliyuncs.com/img/image-20220307182719390.png"/>





<img src= "data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="https://cyw-imgbed.oss-cn-hangzhou.aliyuncs.com/img/image-20220307183940869.png"/>



<p>常用命令：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 设置bitmap，偏移量是数组下标（一般用来表示用户的id），值是0或1</span></span><br><span class="line">setbit 键 偏移量 值</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 获取</span></span><br><span class="line">getbit 键 偏移量</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 统计 bitmaps 字符串中的有多少个bit位是1。开始、结束字节若为负数，表示从最后一个字节开始往前数</span></span><br><span class="line">bitcount 键 开始字节 结束字节</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 位运算，可以做多个bitmaps的 and、or、not、xor等操作，并将结果保存到destkey所表示的bitmaps中</span></span><br><span class="line">bitop 位运算符  运算结果的键 操作bitmaps1的键 操作bitmaps2的键</span><br></pre></td></tr></table></figure>





<p>setbit：</p>
<img src= "data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="https://cyw-imgbed.oss-cn-hangzhou.aliyuncs.com/img/image-20220307182908997.png"/>







<p>bitop：</p>
<iframe style="height:500px;"  src="//player.bilibili.com/player.html?aid=247670776&bvid=BV1Rv41177Af&cid=326379607&page=15" scrolling="no" border="0" frameborder="no" framespacing="0" allowfullscreen="true"> </iframe>



<h2 id="8、hyperloglog-类型"><a href="#8、hyperloglog-类型" class="headerlink" title="8、hyperloglog 类型"></a>8、hyperloglog 类型</h2><p>统计相关的功能需求，例如：网站的 PageView（PV）可以使用Redis 的 incr、incrby 实现。</p>
<p>但是，例如：网站的 UniqueView（UV）、独立IP数、搜索记录数等需要去重的问题应该如何解决？</p>
<p>求集合中不重复元素的个数的问题——<font style="color:red;">基数问题</font></p>
<blockquote>
<p>基数问题的解决方案：</p>
<ul>
<li>存储在MySQL中，使用<code>distinct count(*)</code>计算不重复的个数。</li>
<li>使用 Redis 提供的 hash、set、bitmaps 等数据结构。</li>
</ul>
<p>以上两种方法虽然结果精确，但随着数据量的增加，将导致占用的空间越来越多。</p>
</blockquote>
<p>hyperloglog 类型 就是专门用于做<code>基数统计</code>的数据类型。</p>
<p><font style="color:red;font-size:1.2em">优点：</font></p>
<blockquote>
<p>在输入的数据数量或体积非常大的时候，计算基数所需的空间<font style="color:red;">很小且固定</font>。</p>
<p>在 hyperloglog 类型中，每个键只需花费<code>12 KB</code>的内存就可以计算接近 <font style="color:red;">2^64^</font> 个不同的基数</p>
</blockquote>
<p><font style="color:red;font-size:1.2em">缺点：</font></p>
<blockquote>
<p>只会根据输入元素来计算基数，不会存储输入元素，因此不能返回输入的元素。</p>
</blockquote>
<p>常用命令：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 添加指定元素到 hyperloglog 中，添加成功返回1，失败返回0</span></span><br><span class="line">pfadd 键 元素1 元素2 元素3 .......</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 统计基数</span></span><br><span class="line">pfcount 键</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 将多个hyperloglog 类型的数据合并后保存到另一个 hyperloglog 中</span></span><br><span class="line">pfmerge 合并后的结果键 待合并的htyperloglog1 待合并的htyperloglog2</span><br><span class="line"></span><br></pre></td></tr></table></figure>





<iframe style="height:500px;" src="//player.bilibili.com/player.html?aid=247670776&bvid=BV1Rv41177Af&cid=326379758&page=16" scrolling="no" border="0" frameborder="no" framespacing="0" allowfullscreen="true"> </iframe>





<h2 id="9、geospatial-类型"><a href="#9、geospatial-类型" class="headerlink" title="9、geospatial 类型"></a>9、geospatial 类型</h2><p>geospatial 类型 存储的就是元素的二维坐标（经纬度）。</p>
<p>Redis 基于该数据类型，提供了 经纬度的设置、查询、范围查询、距离查询、经纬度hash等常见操作。</p>
<p>常用命令：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 添加</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 两极无法直接添加，一般使用时会下载城市数据然后通过Java一次性导入。不能重复添加，超出范围会报错。</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 有效的经度：-180~+180</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 有效的纬度：-85.05112878 ~ 85.05112878</span></span><br><span class="line">geoadd 键 经度1 纬度1 地点的名称1 [经度2 纬度2 地点的名称2........]</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 获取</span></span><br><span class="line">geopos 键 地点的名称</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 获取两点之间的直线距离，长度单位：m米（默认）、km千米、ft英尺、mi英里</span></span><br><span class="line">geodist 键 地点的名称1 地点的名称2 长度单位</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 找出方圆多少距离的元素</span></span><br><span class="line">geo 键 经度 纬度 b距离 长度单位</span><br></pre></td></tr></table></figure>















<h1 id="三、Redis-配置文件"><a href="#三、Redis-配置文件" class="headerlink" title="三、Redis 配置文件"></a>三、Redis 配置文件</h1><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;在安装时，我们将Redis的配置文件（<code>redis.conf</code>）复制到了<code>/etc/</code>目录下，并在启动<code>redis-server</code>时，指定了<code>/etc/redis.conf</code>配置文件。下面讲解Redis的配置文件。</p>
<h2 id="0、常用设置"><a href="#0、常用设置" class="headerlink" title="0、常用设置"></a>0、常用设置</h2><p>（1）注释掉 bind，使得 Redis 可以被外网PC访问：</p>
<figure class="highlight dns"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"># bind <span class="number">127.0.0.1</span> -<span class="number">::1</span></span><br></pre></td></tr></table></figure>



<p>（2）将 <code>protected-mode</code> 的值改为<code>no</code>，使得 Redis 可以被外网PC访问：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">protected-mode no</span><br></pre></td></tr></table></figure>



<p>（3）将 <code>daemonize</code> 的值改为<code>yes</code>，使得 Redis 可以后台运行：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">daemonize yes</span><br></pre></td></tr></table></figure>



<p>（4）设置<code>maxmemory</code>，防止内存不足时，服务器宕机：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">maxmemory &lt;bytes&gt;</span><br></pre></td></tr></table></figure>



<p>（5）修改密码<code>requirepass</code>：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">requirepass 你的密码</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 在Java代码中：</span></span><br><span class="line">jedis.auth(&quot;密码&quot;）</span><br></pre></td></tr></table></figure>



<p>（6）重启Redis</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 1.关闭redis,在 redis-cli 所在的目录下输入：</span> </span><br><span class="line">redis-cli -a 密码</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash">  进入到 redis 指令模式，输入：</span></span><br><span class="line">shutdown</span><br><span class="line"> </span><br><span class="line"><span class="meta"> </span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 然后再输入：</span>  </span><br><span class="line">exit</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 2.启动redis</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 在 redis-server 所在的目录下输入：</span> </span><br><span class="line">redis-server redis.conf所在目录/redis.conf</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 可以通过指令 ps aux | grep redis 查看redis状态</span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 开放端口：</span></span><br><span class="line">firewall-cmd --add-port=6379/tcp --permanent</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 重启防火墙生效</span></span><br><span class="line">firewall-cmd --reload</span><br><span class="line">firewall-cmd --query-port=6379/tcp</span><br></pre></td></tr></table></figure>







<h2 id="1、units-单位"><a href="#1、units-单位" class="headerlink" title="1、units 单位"></a>1、units 单位</h2><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Redis 的配置文件的开头定义了一些基本的度量单位，只支持 <code>byte</code>字节，不支持<code>bit</code>位。</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font style="color:purple;">大小写不敏感</font>。</p>
<img src= "data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="https://cyw-imgbed.oss-cn-hangzhou.aliyuncs.com/img/image-20220307120806024.png"/>





<h2 id="2、include-引入其他配置文件"><a href="#2、include-引入其他配置文件" class="headerlink" title="2、include 引入其他配置文件"></a>2、include 引入其他配置文件</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">include /path/to/local.conf</span><br><span class="line"></span><br><span class="line">include /path/to/other.conf</span><br></pre></td></tr></table></figure>





<h2 id="3、network-网络设置"><a href="#3、network-网络设置" class="headerlink" title="3、network 网络设置"></a>3、network 网络设置</h2><h3 id="3-1、bind-绑定-IP-地址"><a href="#3-1、bind-绑定-IP-地址" class="headerlink" title="3.1、bind 绑定 IP 地址"></a>3.1、bind 绑定 IP 地址</h3><p>建议注释掉，否则只能本地访问。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> <span class="built_in">bind</span> 192.168.1.100 10.0.0.1     <span class="comment"># listens on two specific IPv4 addresses</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> <span class="built_in">bind</span> 127.0.0.1 ::1              <span class="comment"># listens on loopback IPv4 and IPv6</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> <span class="built_in">bind</span> * -::*                     <span class="comment"># like the default, all available interfaces</span></span></span><br><span class="line"></span><br><span class="line">bind 127.0.0.1 -::1</span><br></pre></td></tr></table></figure>





<h3 id="3-2、protected-mode-是否允许远程访问"><a href="#3-2、protected-mode-是否允许远程访问" class="headerlink" title="3.2、protected-mode 是否允许远程访问"></a>3.2、protected-mode 是否允许远程访问</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> yes: 不能远程访问</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> no: 可以远程访问</span></span><br><span class="line">protected-mode yes</span><br></pre></td></tr></table></figure>





<h3 id="3-3、port-服务监听的端口"><a href="#3-3、port-服务监听的端口" class="headerlink" title="3.3、port 服务监听的端口"></a>3.3、port 服务监听的端口</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">port 6379</span><br></pre></td></tr></table></figure>





<h3 id="3-4、-tcp-backlog-连接队列"><a href="#3-4、-tcp-backlog-连接队列" class="headerlink" title="3.4、 tcp-backlog 连接队列"></a>3.4、 tcp-backlog 连接队列</h3><p>tcp-backlog 是一个连接队列。</p>
<p><font style="color:red;">tcp-backlog 连接队列总和 = 未完成三次握手的队列 + 已完成三次握手的队列</font></p>
<p>在<font style="color:red;">高并发环境</font>下，需要将<font style="color:red;"> tcp-backlog </font>调高来避免<font style="color:red;">慢客户端连接</font>的问题。</p>
<p><font style="color:red;">注意：</font></p>
<blockquote>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Linux 会将<code>tcp-backlog</code>的值减小到<code>/proc/sys/net/core/somaxconn</code>的值（128）。所以，需要确认增大<code>/proc/sys/net/core/somaxconn</code> 和 <code>/proc/sys/net/ipv4/tcp_max_syn_backlog</code>（128）来达到想要的效果。</p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> TCP listen() backlog.</span></span><br><span class="line"><span class="meta">#</span><span class="bash"></span></span><br><span class="line"><span class="bash"><span class="comment"># In high requests-per-second environments you need a high backlog in order</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> to avoid slow clients connection issues. Note that the Linux kernel</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> will silently truncate it to the value of /proc/sys/net/core/somaxconn so</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> make sure to raise both the value of somaxconn and tcp_max_syn_backlogprotected-mode yes</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> <span class="keyword">in</span> order to get the desired effect.</span></span><br><span class="line"></span><br><span class="line">tcp-backlog 511</span><br></pre></td></tr></table></figure>







<h3 id="3-5、-time-out-超时"><a href="#3-5、-time-out-超时" class="headerlink" title="3.5、 time-out 超时"></a>3.5、 time-out 超时</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> Close the connection after a client is idle <span class="keyword">for</span> N seconds (0 to <span class="built_in">disable</span>)</span></span><br><span class="line">timeout 0</span><br></pre></td></tr></table></figure>





<h3 id="3-6、tcp-keepalive"><a href="#3-6、tcp-keepalive" class="headerlink" title="3.6、tcp-keepalive"></a>3.6、tcp-keepalive</h3><p>300 秒没有操作就断开</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> A reasonable value <span class="keyword">for</span> this option is 300 seconds,</span> </span><br><span class="line">tcp-keepalive 300</span><br></pre></td></tr></table></figure>





<h2 id="4、general-通用配置"><a href="#4、general-通用配置" class="headerlink" title="4、general 通用配置"></a>4、general 通用配置</h2><h3 id="4-1、daemon-后台启动"><a href="#4-1、daemon-后台启动" class="headerlink" title="4.1、daemon 后台启动"></a>4.1、daemon 后台启动</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> By default Redis does not run as a daemon. Use <span class="string">&#x27;yes&#x27;</span> <span class="keyword">if</span> you need it.</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> Note that Redis will write a pid file <span class="keyword">in</span> /var/run/redis.pid when daemonized.</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> When Redis is supervised by upstart or systemd, this parameter has no impact.</span></span><br><span class="line">daemonize yes</span><br></pre></td></tr></table></figure>





<h3 id="4-2、pidfile-文件"><a href="#4-2、pidfile-文件" class="headerlink" title="4.2、pidfile 文件"></a>4.2、pidfile 文件</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> Creating a pid file is best effort: <span class="keyword">if</span> Redis is not able to create it</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> nothing bad happens, the server will start and run normally.</span></span><br><span class="line"><span class="meta">#</span><span class="bash"></span></span><br><span class="line"><span class="bash"><span class="comment"># Note that on modern Linux systems &quot;/run/redis.pid&quot; is more conforming</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> and should be used instead.</span></span><br><span class="line">pidfile /var/run/redis_6379.pid</span><br></pre></td></tr></table></figure>





<h3 id="4-3、loglevel-日志等级"><a href="#4-3、loglevel-日志等级" class="headerlink" title="4.3、loglevel 日志等级"></a>4.3、loglevel 日志等级</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> Specify the server verbosity level.</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> This can be one of:</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 	debug (a lot of information, useful <span class="keyword">for</span> development/testing)</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 	verbose (many rarely useful info, but not a mess like the debug level)</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 	notice (moderately verbose, what you want <span class="keyword">in</span> production probably)</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 	warning (only very important / critical messages are logged)</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 生产环境</span></span><br><span class="line">loglevel notice</span><br></pre></td></tr></table></figure>





<h3 id="4-4、database-默认的数据库数"><a href="#4-4、database-默认的数据库数" class="headerlink" title="4.4、database 默认的数据库数"></a>4.4、database 默认的数据库数</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> Set the number of databases. The default database is DB 0, you can select</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> a different one on a per-connection basis using SELECT &lt;dbid&gt; <span class="built_in">where</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> dbid is a number between 0 and <span class="string">&#x27;databases&#x27;</span>-1</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 范围：[0,databases-1]</span></span><br><span class="line">databases 16</span><br></pre></td></tr></table></figure>







<h2 id="5、security-安全"><a href="#5、security-安全" class="headerlink" title="5、security 安全"></a>5、security 安全</h2><h3 id="5-1、设置密码"><a href="#5-1、设置密码" class="headerlink" title="5.1、设置密码"></a>5.1、设置密码</h3><p>在<code>redis-cli</code>客户端中，输入：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">config get requirepass</span><br><span class="line"></span><br><span class="line">config set requirepass &quot;123456&quot;</span><br><span class="line"></span><br><span class="line">auth 123456</span><br></pre></td></tr></table></figure>





<h2 id="6、limit-限制"><a href="#6、limit-限制" class="headerlink" title="6、limit 限制"></a>6、limit 限制</h2><h3 id="6-1、maxclients-最大客户端连接数"><a href="#6-1、maxclients-最大客户端连接数" class="headerlink" title="6.1、maxclients 最大客户端连接数"></a>6.1、maxclients 最大客户端连接数</h3><ul>
<li><p>该配置用于设置Redis最多同时可以连接多少个客户端。</p>
</li>
<li><p>默认为<code>10000</code>个客户端。</p>
</li>
<li><p>若达到此限制，则拒绝新的连接请求，并向连接的请求方发送<code>max number of clients reached</code>来做回应。</p>
</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> maxclients 10000</span></span><br></pre></td></tr></table></figure>





<h3 id="6-2、maxmemory-最大内存"><a href="#6-2、maxmemory-最大内存" class="headerlink" title="6.2、maxmemory 最大内存"></a>6.2、maxmemory 最大内存</h3><ul>
<li><p><font style="color:red;font-size:1.3em;">建议必须设置</font>，否则当内存满时，会造成服务器宕机。</p>
</li>
<li><p>设置 redis 可以使用的内存大小。一旦达到内存的使用上限，则会移除内部的数据。</p>
</li>
<li><p>移除数据的规则可以通过<code>maxmemory-policy</code>来指定。</p>
</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">maxmemory &lt;bytes&gt;</span><br></pre></td></tr></table></figure>







<h1 id="四、订阅与发布"><a href="#四、订阅与发布" class="headerlink" title="四、订阅与发布"></a>四、订阅与发布</h1><h2 id="1、什么是订阅和发布"><a href="#1、什么是订阅和发布" class="headerlink" title="1、什么是订阅和发布"></a>1、什么是订阅和发布</h2><p>Redis 发布和订阅是一种消息通信模式：</p>
<ul>
<li>发布者（pub）发送消息</li>
<li>订阅者（sub）接受消息</li>
</ul>
<p><code>Redis 客户端</code>可以订阅任意数量的<code>频道</code>。</p>
<p>发布：</p>
<img src= "data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="https://cyw-imgbed.oss-cn-hangzhou.aliyuncs.com/img/image-20220307175345830.png"/>



<p>订阅：</p>
<img src= "data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="https://cyw-imgbed.oss-cn-hangzhou.aliyuncs.com/img/image-20220307175431929.png"/>





<img src= "data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="https://cyw-imgbed.oss-cn-hangzhou.aliyuncs.com/img/image-20220307180709571.png"/>

<img src= "data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="https://cyw-imgbed.oss-cn-hangzhou.aliyuncs.com/img/image-20220307181136474.png"/>



<h2 id="2、订阅与发布的实现案例"><a href="#2、订阅与发布的实现案例" class="headerlink" title="2、订阅与发布的实现案例"></a>2、订阅与发布的实现案例</h2><h3 id="2-1、Redis-客户端1-订阅频道"><a href="#2-1、Redis-客户端1-订阅频道" class="headerlink" title="2.1、Redis 客户端1 订阅频道"></a>2.1、Redis 客户端1 订阅频道</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 订阅频道(channel_1)</span></span><br><span class="line">subscribe channel_1</span><br></pre></td></tr></table></figure>







<h3 id="2-2、Redis-客户端2-发布消息"><a href="#2-2、Redis-客户端2-发布消息" class="headerlink" title="2.2、Redis 客户端2 发布消息"></a>2.2、Redis 客户端2 发布消息</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 向redis客户端1所订阅的频道channel_1 发布消息</span></span><br><span class="line">publish channel_1 hello—world</span><br></pre></td></tr></table></figure>









<h3 id="2-2、Redis-客户端1-接收消息"><a href="#2-2、Redis-客户端1-接收消息" class="headerlink" title="2.2、Redis 客户端1 接收消息"></a>2.2、Redis 客户端1 接收消息</h3><img src= "data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="https://cyw-imgbed.oss-cn-hangzhou.aliyuncs.com/img/image-20220307181245499.png"/>





<h1 id="五、Jedis-操作"><a href="#五、Jedis-操作" class="headerlink" title="五、Jedis 操作"></a>五、Jedis 操作</h1><h2 id="1、Maven-依赖"><a href="#1、Maven-依赖" class="headerlink" title="1、Maven 依赖"></a>1、Maven 依赖</h2><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>redis.clients<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jedis<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">version</span>&gt;</span>4.0.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>





<h2 id="2、Jedis-的连通"><a href="#2、Jedis-的连通" class="headerlink" title="2、Jedis 的连通"></a>2、Jedis 的连通</h2><p>（1）修改Redis的设置：</p>
<p>（注释掉<code>/etc/redis.conf</code>配置文件中的bind语句，protected-mode设为no，重启 Redis 服务）</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 关闭Redis服务</span></span><br><span class="line"><span class="built_in">kill</span> -9 6379</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 打开Redis服务</span></span><br><span class="line">/usr/<span class="built_in">local</span>/bin/redis-server /etc/redis.conf</span><br></pre></td></tr></table></figure>





<p>（2）关闭CentOS 的防火墙</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 查看防火墙</span></span><br><span class="line">systemctl status firewalld</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 关闭防火墙</span></span><br><span class="line"> systemctl stop firewalld</span><br></pre></td></tr></table></figure>



<p>（3）测试Jedis能否连通Redis服务器：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.cyw;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> redis.clients.jedis.Jedis;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TestJedis</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 根据ip地址、端口，创建Jedis对象</span></span><br><span class="line">        Jedis jedis = <span class="keyword">new</span> Jedis(<span class="string">&quot;192.168.220.137&quot;</span>,<span class="number">6379</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 测试能否连通Redis服务器</span></span><br><span class="line">        String ping = jedis.ping();</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 打印 pong 表示已经连通</span></span><br><span class="line">        System.out.println(ping);</span><br><span class="line">        </span><br><span class="line">        jedis.close();</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>





<h2 id="3、Jedis-的-API-keys"><a href="#3、Jedis-的-API-keys" class="headerlink" title="3、Jedis 的 API-keys"></a>3、Jedis 的 API-keys</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">demo1</span><span class="params">()</span></span>&#123;</span><br><span class="line">      Jedis jedis = <span class="keyword">new</span> Jedis(<span class="string">&quot;192.168.220.137&quot;</span>, <span class="number">6379</span>);</span><br><span class="line"></span><br><span class="line">      <span class="comment">// 查询Redis的当前数据库中的所有键</span></span><br><span class="line">      <span class="comment">// 相当于Redis原生的命令：keys *</span></span><br><span class="line">      Set&lt;String&gt; keys = jedis.keys(<span class="string">&quot;*&quot;</span>);</span><br><span class="line">      System.out.println(keys);</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>





<h2 id="4、Jedis-的-API-String"><a href="#4、Jedis-的-API-String" class="headerlink" title="4、Jedis 的 API-String"></a>4、Jedis 的 API-String</h2><p>其他类型与String类型的用法类型，都是将原生的命令改为方法。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">demo1</span><span class="params">()</span></span>&#123;</span><br><span class="line">    Jedis jedis = <span class="keyword">new</span> Jedis(<span class="string">&quot;192.168.220.137&quot;</span>, <span class="number">6379</span>);</span><br><span class="line">		</span><br><span class="line">    <span class="comment">// 添加str类型的数据</span></span><br><span class="line">    String ok = jedis.set(<span class="string">&quot;k1&quot;</span>, <span class="string">&quot;abc&quot;</span>);</span><br><span class="line">    System.out.println(ok);</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 获取str类型的数据</span></span><br><span class="line">    String k1 = jedis.get(<span class="string">&quot;k1&quot;</span>);</span><br><span class="line">    System.out.println(k1);</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 判断某个键是否存在</span></span><br><span class="line">    <span class="keyword">boolean</span> isExist = jedis.exists(<span class="string">&quot;k1&quot;</span>);</span><br><span class="line">    System.out.println(isExist);</span><br><span class="line">    </span><br><span class="line">            </span><br><span class="line">    <span class="comment">// 设置有效期（秒）</span></span><br><span class="line">    jedis.expire(<span class="string">&quot;k1&quot;</span>, <span class="number">30</span>);</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 获取剩余有效期（秒）：-1永不过期，-2已过期</span></span><br><span class="line">    <span class="keyword">long</span> ttl = jedis.ttl(<span class="string">&quot;k1&quot;</span>);</span><br><span class="line">    System.out.println(ttl);</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 批量设置</span></span><br><span class="line">    jedis.mset(<span class="string">&quot;k1&quot;</span>,<span class="string">&quot;a1&quot;</span>,<span class="string">&quot;k2&quot;</span>,<span class="string">&quot;a2&quot;</span>);</span><br><span class="line">    System.out.println(jedis.get(<span class="string">&quot;k1&quot;</span>));</span><br><span class="line">    System.out.println(jedis.get(<span class="string">&quot;k2&quot;</span>));</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 释放资源</span></span><br><span class="line">    jedis.close();</span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>







<h1 id="六、案例-模拟手机验证码"><a href="#六、案例-模拟手机验证码" class="headerlink" title="六、案例-模拟手机验证码"></a>六、案例-模拟手机验证码</h1><h2 id="1、要求"><a href="#1、要求" class="headerlink" title="1、要求"></a>1、要求</h2><ul>
<li>输入手机号，点击发送，随机生成6位数字的验证码，2分钟有效</li>
<li>输入验证码，点击验证，返回成功或失败</li>
<li>每个手机号每天只能输入3次</li>
</ul>
<h2 id="2、实现思路"><a href="#2、实现思路" class="headerlink" title="2、实现思路"></a>2、实现思路</h2><ul>
<li>随机生成6位数字的验证码：Java中的<code>Random</code>类的<code>nextInt()</code>方法。</li>
<li>2分钟有效：使用 Jedis操作Redis设置验证码的有效期（<code>jedis.expire(&quot;键&quot;,有效秒数)</code>）</li>
<li>返回成功或失败：使用Jedis的<code>jedis.get(&quot;键&quot;)</code>获取Redis中的验证码，并将取出的值与用户的输入值比较</li>
<li>每天只能输入3次：使用Redis的<code>incrby</code>命令</li>
</ul>
<h2 id="3、实现"><a href="#3、实现" class="headerlink" title="3、实现"></a>3、实现</h2><h3 id="3-1、生成验证码"><a href="#3-1、生成验证码" class="headerlink" title="3.1、生成验证码"></a>3.1、生成验证码</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 生成6位数的验证码的方法</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">getCode</span><span class="params">()</span></span>&#123;</span><br><span class="line">      Random rd = <span class="keyword">new</span> Random();</span><br><span class="line">      String str = <span class="string">&quot;&quot;</span>;</span><br><span class="line">      <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">6</span>; i++) &#123;</span><br><span class="line">          str += rd.nextInt(<span class="number">10</span>);</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">return</span> str;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>





<h3 id="3-2、限制每个手机每天只能发送三次"><a href="#3-2、限制每个手机每天只能发送三次" class="headerlink" title="3.2、限制每个手机每天只能发送三次"></a>3.2、限制每个手机每天只能发送三次</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 限制每个手机每天只能发送3次，</span></span><br><span class="line">  <span class="comment">// 存储验证码到Redis，设置过期时间</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">sendCode</span><span class="params">(String phone)</span></span>&#123;</span><br><span class="line"></span><br><span class="line">      Jedis jedis = <span class="keyword">new</span> Jedis(<span class="string">&quot;192.168.220.137&quot;</span>, <span class="number">6379</span>);</span><br><span class="line"></span><br><span class="line">      <span class="comment">// 拼接用户验证码生成次数的key</span></span><br><span class="line">      String countKey = <span class="string">&quot;verifyCode&quot;</span>+phone+<span class="string">&quot;:count&quot;</span>;</span><br><span class="line"></span><br><span class="line">      <span class="comment">// 尝试去Redis中获取验证码的生成次数</span></span><br><span class="line">      String count = jedis.get(countKey);</span><br><span class="line">      </span><br><span class="line">      <span class="keyword">if</span> (count == <span class="keyword">null</span>)&#123;</span><br><span class="line">          <span class="comment">// 为null表示没有验证码（第一次生成验证码）</span></span><br><span class="line">          <span class="comment">// 有效期：一天</span></span><br><span class="line">          jedis.setex(countKey,<span class="number">24</span>*<span class="number">60</span>*<span class="number">60</span>,<span class="string">&quot;1&quot;</span>);</span><br><span class="line">      &#125;<span class="keyword">else</span> <span class="keyword">if</span> (Integer.parseInt(count)&lt;<span class="number">3</span>)&#123;</span><br><span class="line">          jedis.incr(countKey);</span><br><span class="line">      &#125;<span class="keyword">else</span> <span class="keyword">if</span> (Integer.parseInt(count)&gt;=<span class="number">3</span>)&#123;</span><br><span class="line">          System.out.println(<span class="string">&quot;今天的发送次数已达3次，不能再发送了&quot;</span>);</span><br><span class="line">          jedis.close();</span><br><span class="line">	<span class="keyword">return</span>;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="comment">// 拼接用户验证码的key</span></span><br><span class="line">      String codeKey = <span class="string">&quot;verifyCode&quot;</span>+phone+<span class="string">&quot;:code&quot;</span>;</span><br><span class="line"></span><br><span class="line">      <span class="comment">// 后端生成验证码</span></span><br><span class="line">      String code = PhoneCode.getCode();</span><br><span class="line"></span><br><span class="line">      <span class="comment">// 设置验证码的有效期为2分钟</span></span><br><span class="line">      jedis.setex(codeKey,<span class="number">120</span>,code);</span><br><span class="line"></span><br><span class="line">      jedis.close();        </span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>



<h3 id="3-3、校验验证码"><a href="#3-3、校验验证码" class="headerlink" title="3.3、校验验证码"></a>3.3、校验验证码</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 校验验证码</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">verifyCode</span><span class="params">(String phone,String code)</span></span>&#123;</span><br><span class="line"></span><br><span class="line">      Jedis jedis = <span class="keyword">new</span> Jedis(<span class="string">&quot;192.168.220.137&quot;</span>, <span class="number">6379</span>);</span><br><span class="line"></span><br><span class="line">      <span class="comment">// 拼接用户验证码的key</span></span><br><span class="line">      String codeKey = <span class="string">&quot;verifyCode&quot;</span>+phone+<span class="string">&quot;:code&quot;</span>;</span><br><span class="line"></span><br><span class="line">      String redisCode = jedis.get(codeKey);</span><br><span class="line"></span><br><span class="line">      <span class="keyword">if</span> (redisCode.equalsIgnoreCase(code))&#123;</span><br><span class="line">          System.out.println(<span class="string">&quot;验证通过！&quot;</span>);</span><br><span class="line">      &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">          System.out.println(<span class="string">&quot;验证失败！&quot;</span>);</span><br><span class="line">      &#125;</span><br><span class="line">      jedis.close();</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>





<h3 id="3-4、测试"><a href="#3-4、测试" class="headerlink" title="3.4、测试"></a>3.4、测试</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line"><span class="comment">//        sendCode(&quot;123456&quot;);</span></span><br><span class="line">        verifyCode(<span class="string">&quot;123456&quot;</span>,<span class="string">&quot;844525&quot;</span>);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>





<h3 id="3-5、完整版代码"><a href="#3-5、完整版代码" class="headerlink" title="3.5、完整版代码"></a>3.5、完整版代码</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.cyw;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> redis.clients.jedis.Jedis;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.Random;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">PhoneCode</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line"><span class="comment">//        sendCode(&quot;123456&quot;);</span></span><br><span class="line">        verifyCode(<span class="string">&quot;123456&quot;</span>,<span class="string">&quot;844525&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 生成6位数的验证码</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">getCode</span><span class="params">()</span></span>&#123;</span><br><span class="line">        Random rd = <span class="keyword">new</span> Random();</span><br><span class="line">        String str = <span class="string">&quot;&quot;</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">6</span>; i++) &#123;</span><br><span class="line">            str += rd.nextInt(<span class="number">10</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> str;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 限制每个手机每天只能发送3次，</span></span><br><span class="line">    <span class="comment">// 存储验证码到Redis，设置过期时间</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">sendCode</span><span class="params">(String phone)</span></span>&#123;</span><br><span class="line"></span><br><span class="line">        Jedis jedis = <span class="keyword">new</span> Jedis(<span class="string">&quot;192.168.220.137&quot;</span>, <span class="number">6379</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 拼接用户验证码生成次数的key</span></span><br><span class="line">        String countKey = <span class="string">&quot;verifyCode&quot;</span>+phone+<span class="string">&quot;:count&quot;</span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 尝试去Redis中获取验证码的生成次数</span></span><br><span class="line">        String count = jedis.get(countKey);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (count == <span class="keyword">null</span>)&#123;</span><br><span class="line">            <span class="comment">// 为null表示没有验证码（第一次生成验证码）</span></span><br><span class="line">            <span class="comment">// 有效期：一天</span></span><br><span class="line">            jedis.setex(countKey,<span class="number">24</span>*<span class="number">60</span>*<span class="number">60</span>,<span class="string">&quot;1&quot;</span>);</span><br><span class="line">        &#125;<span class="keyword">else</span> <span class="keyword">if</span> (Integer.parseInt(count)&lt;<span class="number">3</span>)&#123;</span><br><span class="line">            jedis.incr(countKey);</span><br><span class="line">        &#125;<span class="keyword">else</span> <span class="keyword">if</span> (Integer.parseInt(count)&gt;=<span class="number">3</span>)&#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;今天的发送次数已达3次，不能再发送了&quot;</span>);</span><br><span class="line">            jedis.close();</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 拼接用户验证码的key</span></span><br><span class="line">        String codeKey = <span class="string">&quot;verifyCode&quot;</span>+phone+<span class="string">&quot;:code&quot;</span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 后端生成验证码</span></span><br><span class="line">        String code = PhoneCode.getCode();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 设置验证码的有效期为2分钟</span></span><br><span class="line">        jedis.setex(codeKey,<span class="number">120</span>,code);</span><br><span class="line"></span><br><span class="line">        jedis.close();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 校验验证码</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">verifyCode</span><span class="params">(String phone,String code)</span></span>&#123;</span><br><span class="line"></span><br><span class="line">        Jedis jedis = <span class="keyword">new</span> Jedis(<span class="string">&quot;192.168.220.137&quot;</span>, <span class="number">6379</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 拼接用户验证码的key</span></span><br><span class="line">        String codeKey = <span class="string">&quot;verifyCode&quot;</span>+phone+<span class="string">&quot;:code&quot;</span>;</span><br><span class="line"></span><br><span class="line">        String redisCode = jedis.get(codeKey);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (redisCode.equalsIgnoreCase(code))&#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;验证通过！&quot;</span>);</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;验证失败！&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        jedis.close();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>







<h1 id="七、Redis-整合-SpringBoot"><a href="#七、Redis-整合-SpringBoot" class="headerlink" title="七、Redis 整合 SpringBoot"></a>七、Redis 整合 SpringBoot</h1><ul>
<li><a target="_blank" rel="noopener" href="https://blog.csdn.net/lydms/article/details/105224210">RedisTemplate操作Redis</a></li>
</ul>
<h2 id="1、Maven依赖"><a href="#1、Maven依赖" class="headerlink" title="1、Maven依赖"></a>1、Maven依赖</h2><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-data-redis<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">     <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.commons<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>commons-pool2<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.10.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>







<h2 id="2、SpringBoot-的配置文件中的-Redis-部分"><a href="#2、SpringBoot-的配置文件中的-Redis-部分" class="headerlink" title="2、SpringBoot 的配置文件中的 Redis 部分"></a>2、SpringBoot 的配置文件中的 Redis 部分</h2><p><code>application.properties</code></p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">spring.redis.host</span>=<span class="string">192.168.220.137			# redis 服务器的地址</span></span><br><span class="line"><span class="meta">spring.redis.port</span>=<span class="string">6379						# redis 服务器的端口</span></span><br><span class="line"><span class="meta">spring.redis.database</span>=<span class="string">0						# redis服务器的数据库索引</span></span><br><span class="line"><span class="meta">spring.redis.timeout</span>=<span class="string">1800000				# 连接超时时间（毫秒）</span></span><br><span class="line"><span class="meta">spring.redis.lettuce.pool.max-active</span>=<span class="string">20		# 最大连接数，负值表示无限制</span></span><br><span class="line"><span class="meta">spring.redis.lettuce.pool.max-wait</span>=<span class="string">-1		# 最大阻塞等待时间，负值表示无限制</span></span><br><span class="line"><span class="meta">spring.redis.lettuce.pool.max-idle</span>=<span class="string">5		# 最大连接</span></span><br><span class="line"><span class="meta">spring.redis.lettuce.pool.min-idle</span>=<span class="string">0		# 最小连接</span></span><br></pre></td></tr></table></figure>





<h2 id="3、SpringBoot-的-Redis-配置类"><a href="#3、SpringBoot-的-Redis-配置类" class="headerlink" title="3、SpringBoot 的 Redis 配置类"></a>3、SpringBoot 的 Redis 配置类</h2><p>教程：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@EnableCaching</span></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">RedisConfig</span> <span class="keyword">extends</span> <span class="title">CachingConfigurerSupport</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> RedisTemplate&lt;String, Object&gt; <span class="title">redisTemplate</span><span class="params">(RedisConnectionFactory factory)</span> </span>&#123;</span><br><span class="line">        RedisTemplate&lt;String, Object&gt; template = <span class="keyword">new</span> RedisTemplate&lt;&gt;();</span><br><span class="line">        RedisSerializer&lt;String&gt; redisSerializer = <span class="keyword">new</span> StringRedisSerializer();</span><br><span class="line">        Jackson2JsonRedisSerializer jackson2JsonRedisSerializer = <span class="keyword">new</span> Jackson2JsonRedisSerializer(Object.class);</span><br><span class="line">        ObjectMapper om = <span class="keyword">new</span> ObjectMapper();</span><br><span class="line">        om.setVisibility(PropertyAccessor.ALL, JsonAutoDetect.Visibility.ANY);</span><br><span class="line">          om.activateDefaultTyping(LaissezFaireSubTypeValidator.instance ,</span><br><span class="line">                ObjectMapper.DefaultTyping.NON_FINAL, JsonTypeInfo.As.PROPERTY);</span><br><span class="line">        jackson2JsonRedisSerializer.setObjectMapper(om);</span><br><span class="line">        template.setConnectionFactory(factory);</span><br><span class="line"><span class="comment">//key序列化方式</span></span><br><span class="line">        template.setKeySerializer(redisSerializer);</span><br><span class="line"><span class="comment">//value序列化</span></span><br><span class="line">        template.setValueSerializer(jackson2JsonRedisSerializer);</span><br><span class="line"><span class="comment">//value hashmap序列化</span></span><br><span class="line">        template.setHashValueSerializer(jackson2JsonRedisSerializer);</span><br><span class="line">        <span class="keyword">return</span> template;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> CacheManager <span class="title">cacheManager</span><span class="params">(RedisConnectionFactory factory)</span> </span>&#123;</span><br><span class="line">        RedisSerializer&lt;String&gt; redisSerializer = <span class="keyword">new</span> StringRedisSerializer();</span><br><span class="line">        Jackson2JsonRedisSerializer jackson2JsonRedisSerializer = <span class="keyword">new</span> Jackson2JsonRedisSerializer(Object.class);</span><br><span class="line"><span class="comment">//解决查询缓存转换异常的问题</span></span><br><span class="line">        ObjectMapper om = <span class="keyword">new</span> ObjectMapper();</span><br><span class="line">        om.setVisibility(PropertyAccessor.ALL, JsonAutoDetect.Visibility.ANY);</span><br><span class="line">         om.activateDefaultTyping(LaissezFaireSubTypeValidator.instance,</span><br><span class="line">                ObjectMapper.DefaultTyping.NON_FINAL, JsonTypeInfo.As.PROPERTY);</span><br><span class="line">        jackson2JsonRedisSerializer.setObjectMapper(om);</span><br><span class="line"><span class="comment">// 配置序列化（解决乱码的问题）,过期时间600秒</span></span><br><span class="line">        RedisCacheConfiguration config = RedisCacheConfiguration.defaultCacheConfig()</span><br><span class="line">                .entryTtl(Duration.ofSeconds(<span class="number">600</span>))</span><br><span class="line">                .serializeKeysWith(RedisSerializationContext.SerializationPair.fromSerializer(redisSerializer))</span><br><span class="line">                .serializeValuesWith(RedisSerializationContext.SerializationPair.fromSerializer(jackson2JsonRedisSerializer))</span><br><span class="line">                .disableCachingNullValues();</span><br><span class="line">        RedisCacheManager cacheManager = RedisCacheManager.builder(factory)</span><br><span class="line">                .cacheDefaults(config)</span><br><span class="line">                .build();</span><br><span class="line">        <span class="keyword">return</span> cacheManager;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>





<p>解决乱码：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">RedisConfig</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 解决Redis乱码问题</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> redisConnectionFactory</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> RedisTemplate <span class="title">redisTemplate</span><span class="params">(RedisConnectionFactory redisConnectionFactory)</span> </span>&#123;</span><br><span class="line">        RedisTemplate redisTemplate = <span class="keyword">new</span> RedisTemplate();</span><br><span class="line">        redisTemplate.setConnectionFactory(redisConnectionFactory);</span><br><span class="line">        Jackson2JsonRedisSerializer jackson2JsonRedisSerializer = <span class="keyword">new</span> Jackson2JsonRedisSerializer(Object.class);</span><br><span class="line"></span><br><span class="line">        ObjectMapper objectMapper = <span class="keyword">new</span> ObjectMapper();</span><br><span class="line">        objectMapper.setVisibility(PropertyAccessor.ALL, JsonAutoDetect.Visibility.ANY);</span><br><span class="line">        objectMapper.enableDefaultTyping(ObjectMapper.DefaultTyping.NON_FINAL);</span><br><span class="line"></span><br><span class="line">        jackson2JsonRedisSerializer.setObjectMapper(objectMapper);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//重点在这四行代码</span></span><br><span class="line">        redisTemplate.setKeySerializer(<span class="keyword">new</span> StringRedisSerializer());</span><br><span class="line">        redisTemplate.setValueSerializer(jackson2JsonRedisSerializer);</span><br><span class="line">        redisTemplate.setHashKeySerializer(<span class="keyword">new</span> StringRedisSerializer());</span><br><span class="line">        redisTemplate.setHashValueSerializer(jackson2JsonRedisSerializer);</span><br><span class="line"></span><br><span class="line">        redisTemplate.afterPropertiesSet();</span><br><span class="line">        <span class="keyword">return</span> redisTemplate;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>





<h2 id="4、测试类"><a href="#4、测试类" class="headerlink" title="4、测试类"></a>4、测试类</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/redisTest&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">RedisTestController</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> RedisTemplate redisTemplate;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">testRedis</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">//设置值到redis</span></span><br><span class="line">        redisTemplate.opsForValue().set(<span class="string">&quot;name&quot;</span>,<span class="string">&quot;学习aaa&quot;</span>);</span><br><span class="line">        <span class="comment">//从redis获取值</span></span><br><span class="line">        String name = (String)redisTemplate.opsForValue().get(<span class="string">&quot;name&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> name;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>









<h1 id="八、事务-与-锁机制"><a href="#八、事务-与-锁机制" class="headerlink" title="八、事务 与 锁机制"></a>八、事务 与 锁机制</h1><p>Redis 事务是一个单独的隔离操作：</p>
<ul>
<li>事务中的所有命令都会序列化、按顺序执行。</li>
<li>事务在执行过程中，不会被其他客户端发送的命令请求打断。</li>
</ul>
<p>Redis 事务的主要作用：<font style="color:red;">串联多个命令，防止别的命令插队。</font></p>
<p>不支持ACID</p>
<h2 id="1、基本操作"><a href="#1、基本操作" class="headerlink" title="1、基本操作"></a>1、基本操作</h2><ul>
<li><p><code>multi</code>：排队（开启事务）</p>
</li>
<li><p><code>exec</code> ：执行</p>
</li>
<li><p><code>discard</code>：放弃排队（回滚）</p>
</li>
</ul>
<img src= "data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="https://cyw-imgbed.oss-cn-hangzhou.aliyuncs.com/img/image-20220311132347204.png"/>









<p>开启事务、执行事务：</p>
<img src= "data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="https://cyw-imgbed.oss-cn-hangzhou.aliyuncs.com/img/image-20220311132716797.png"/>





<p>回滚事务：</p>
<img src= "data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="https://cyw-imgbed.oss-cn-hangzhou.aliyuncs.com/img/image-20220311132814188.png"/>







<h2 id="2、事务的错误处理"><a href="#2、事务的错误处理" class="headerlink" title="2、事务的错误处理"></a>2、事务的错误处理</h2><h3 id="2-1、组队出错"><a href="#2-1、组队出错" class="headerlink" title="2.1、组队出错"></a>2.1、组队出错</h3><p>组队阶段的出现错误，则队列内的命令都不会执行成功：</p>
<img src= "data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="https://cyw-imgbed.oss-cn-hangzhou.aliyuncs.com/img/image-20220311132919586.png"/>

<img src= "data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="https://cyw-imgbed.oss-cn-hangzhou.aliyuncs.com/img/image-20220311133107022.png"/>



<h3 id="2-2、执行出错"><a href="#2-2、执行出错" class="headerlink" title="2.2、执行出错"></a>2.2、执行出错</h3><p>执行阶段的出现错误，则队列内正确的命令可以执行成功：</p>
<img src= "data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="https://cyw-imgbed.oss-cn-hangzhou.aliyuncs.com/img/image-20220311133408335.png"/>





<h2 id="3、悲观锁"><a href="#3、悲观锁" class="headerlink" title="3、悲观锁"></a>3、悲观锁</h2><p><font style="color:red;font-size:1.3em;">悲观锁：</font>每次取数据，都认为别人会修改，所以每次拿数据时都会上锁，其他人取数据时会进入阻塞状态。传统的关系型数据库里的<code>行锁</code>、<code>表锁</code>、<code>读锁</code>、<code>写锁</code>等就利用了悲观锁机制。</p>
<p>缺点：效率低。</p>
<iframe 
style="height:500px;"  src="//player.bilibili.com/player.html?aid=247670776&bvid=BV1Rv41177Af&cid=326381446&page=22" scrolling="no" border="0" frameborder="no" framespacing="0" allowfullscreen="true"> </iframe>




<h2 id="4、乐观锁"><a href="#4、乐观锁" class="headerlink" title="4、乐观锁"></a>4、乐观锁</h2><p><font style="color:red;font-size:1.3em;">乐观锁：</font>给数据加上一个版本号，更新数据的时候，检查版本号是否与数据库中的一致。适用于<code>多读</code>的情况（如：抢票），可以提高吞吐量。Redis 就是利用这种 <code>check-and-set</code>机制实现事务的。</p>
<p><font style="color:red;font-size:1.3em;">乐观锁的使用：（watch 命令）</font></p>
<blockquote>
<p>假设现在有2个Redis客户端，同时操作键名为“balance”的数据：</p>
<ul>
<li>（双方）先执行<code>watch</code>命令，监视某些键（如：<code>watch balance</code>）。</li>
<li>（双方）再执行<code>multi</code>命令，开启事务。</li>
<li>（双方）数据更新操作加入到队列（如：<code>incrby balance 10</code>）</li>
<li>执行队列中的操作<code>exec</code></li>
<li>当第二个客户端执行操作时，返回<code>nil</code>表示Redis客户端2的更新操作执行执行失败。（乐观锁生效）</li>
<li>取消监视<code>unwatch</code>。</li>
</ul>
</blockquote>
<iframe style="height:500px;"  src="//player.bilibili.com/player.html?aid=247670776&bvid=BV1Rv41177Af&cid=326381509&page=23" scrolling="no" border="0" frameborder="no" framespacing="0" allowfullscreen="true"> </iframe>







<h2 id="5、Redis-事务的三个特性"><a href="#5、Redis-事务的三个特性" class="headerlink" title="5、Redis 事务的三个特性"></a>5、Redis 事务的三个特性</h2><blockquote>
<ul>
<li>单独的隔离操作（所有命令顺序执行，不会被其它客户端的命令打断）</li>
<li>没有隔离级别的概念（队列中的所有命令，没提交前都不会被实际执行）</li>
<li>不保证原子性（队列中的一条命令执行失败，其他正确的命令不会回滚，仍然执行）</li>
</ul>
</blockquote>
<h2 id="6、案例-秒杀"><a href="#6、案例-秒杀" class="headerlink" title="6、案例-秒杀"></a>6、案例-秒杀</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.cyw.kill;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> redis.clients.jedis.Jedis;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">KillTest</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        Jedis jedis = <span class="keyword">new</span> Jedis(<span class="string">&quot;192.168.220.138&quot;</span>, <span class="number">6379</span>);</span><br><span class="line">        System.out.println(jedis.ping());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">doKill</span><span class="params">(String uid,String productId)</span></span>&#123;</span><br><span class="line">        <span class="comment">// 1、判断uid和productId是否为null</span></span><br><span class="line">        <span class="keyword">if</span> (uid == <span class="keyword">null</span> || productId == <span class="keyword">null</span>)&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 2、连接Redis服务器</span></span><br><span class="line">        Jedis jedis = <span class="keyword">new</span> Jedis(<span class="string">&quot;192.168.220.138&quot;</span>, <span class="number">6379</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="comment">// 3、拼接库存key</span></span><br><span class="line">        String remainNumKey= <span class="string">&quot;kill_DB:&quot;</span>+productId+<span class="string">&quot;:qt&quot;</span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 4、拼接秒杀成功的用户key</span></span><br><span class="line">        String userKey = <span class="string">&quot;kill_DB:&quot;</span>+uid+<span class="string">&quot;:user&quot;</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="comment">// 5、获取库存，若为null，表示还没开始</span></span><br><span class="line">        String remainNum = jedis.get(remainNumKey);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (remainNum == <span class="keyword">null</span>)&#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;秒杀还没开始！&quot;</span>);</span><br><span class="line">            jedis.close();</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 6、判断用户是否重复秒杀</span></span><br><span class="line">        <span class="keyword">if</span>(jedis.sismember(userKey, uid))&#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;已经秒杀成功，不能重复秒杀&quot;</span>);</span><br><span class="line">            jedis.close();</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 7、判断如果商品数量、库存小于1，秒杀结束</span></span><br><span class="line">        <span class="keyword">if</span> (Integer.parseInt(remainNum) &lt; <span class="number">1</span>)&#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;秒杀已经结束！&quot;</span>);</span><br><span class="line">            jedis.close();</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 秒杀过程，库存减一，把用户添加到名单里</span></span><br><span class="line">        jedis.decr(remainNumKey);</span><br><span class="line">        jedis.sadd(userKey,uid);</span><br><span class="line">        System.out.println(<span class="string">&quot;秒杀成功！&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>





<h2 id="7、ab工具模拟并发"><a href="#7、ab工具模拟并发" class="headerlink" title="7、ab工具模拟并发"></a>7、ab工具模拟并发</h2><p>（1）安装：<code>yum install httpd-tools</code></p>
<p>（2）检查是否安装成功：<code>ab --help</code></p>
<p>（3）请求1000次，并发量100：<code>ab -n 1000 -c 100 http://192.168.220.138:8080/secondKill</code></p>
<p>（4）POST请求时，把请求体放到文件里，并指定请求参数的类型(请求路径不能写localhost)：<code>ab -n 1000 -c 100 -p postfile -T &#39;application/x-www-form-urlencoded&#39;  需要测试的网站的url</code></p>
<iframe style="height:500px;"
  src="//player.bilibili.com/player.html?aid=247670776&bvid=BV1Rv41177Af&cid=326381628&page=25" scrolling="no" border="0" frameborder="no" framespacing="0" allowfullscreen="true"> </iframe>




<p>连接超时问题：【使用连接池】</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">JedisPoolUtil</span> </span>&#123;</span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">volatile</span> JedisPool jedisPool = <span class="keyword">null</span>;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">private</span> <span class="title">JedisPoolUtil</span><span class="params">()</span> </span>&#123;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> JedisPool <span class="title">getJedisPoolInstance</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">if</span> (<span class="keyword">null</span> == jedisPool) &#123;</span><br><span class="line">			<span class="keyword">synchronized</span> (JedisPoolUtil.class) &#123;</span><br><span class="line">				<span class="keyword">if</span> (<span class="keyword">null</span> == jedisPool) &#123;</span><br><span class="line">					JedisPoolConfig poolConfig = <span class="keyword">new</span> JedisPoolConfig();</span><br><span class="line">					poolConfig.setMaxTotal(<span class="number">200</span>);</span><br><span class="line">					poolConfig.setMaxIdle(<span class="number">32</span>);</span><br><span class="line">					poolConfig.setMaxWaitMillis(<span class="number">100</span>*<span class="number">1000</span>);</span><br><span class="line">					poolConfig.setBlockWhenExhausted(<span class="keyword">true</span>);</span><br><span class="line">					poolConfig.setTestOnBorrow(<span class="keyword">true</span>);  <span class="comment">// ping  PONG，判断是否还存在</span></span><br><span class="line">				 </span><br><span class="line">                    <span class="comment">// 配置、ip、端口、超时时间</span></span><br><span class="line">					jedisPool = <span class="keyword">new</span> JedisPool(poolConfig, <span class="string">&quot;172.22.109.205&quot;</span>, <span class="number">6379</span>, <span class="number">60000</span> );</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">return</span> jedisPool;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">release</span><span class="params">(JedisPool jedisPool, Jedis jedis)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">if</span> (<span class="keyword">null</span> != jedis) &#123;</span><br><span class="line">			jedisPool.returnResource(jedis);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>在【秒杀案例的代码中】通过创建连接池再来获取数据：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//2 连接redis</span></span><br><span class="line"><span class="comment">//Jedis jedis = new Jedis(&quot;192.168.44.168&quot;,6379);</span></span><br><span class="line"><span class="comment">//通过连接池得到jedis对象</span></span><br><span class="line">JedisPool jedisPoolInstance = JedisPoolUtil.getJedisPoolInstance();</span><br><span class="line">Jedis jedis = jedisPoolInstance.getResource();</span><br></pre></td></tr></table></figure>





<p>最终的【秒杀案例代码】：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.cyw.kill;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> redis.clients.jedis.Jedis;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">KillTest</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        Jedis jedis = <span class="keyword">new</span> Jedis(<span class="string">&quot;192.168.220.138&quot;</span>, <span class="number">6379</span>);</span><br><span class="line">        System.out.println(jedis.ping());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">doKill</span><span class="params">(String uid,String productId)</span></span>&#123;</span><br><span class="line">        <span class="comment">// 1、判断uid和productId是否为null</span></span><br><span class="line">        <span class="keyword">if</span> (uid == <span class="keyword">null</span> || productId == <span class="keyword">null</span>)&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 2、连接Redis服务器</span></span><br><span class="line">        JedisPool jedisPoolInstance = JedisPoolUtil.getJedisPoolInstance();</span><br><span class="line">		Jedis jedis = jedisPoolInstance.getResource();</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 3、拼接库存key</span></span><br><span class="line">        String remainNumKey= <span class="string">&quot;kill_DB:&quot;</span>+productId+<span class="string">&quot;:qt&quot;</span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 4、拼接秒杀成功的用户key</span></span><br><span class="line">        String userKey = <span class="string">&quot;kill_DB:&quot;</span>+uid+<span class="string">&quot;:user&quot;</span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 监视库存（乐观锁）</span></span><br><span class="line">        jedis.watch(remainNumKey);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 5、获取库存，若为null，表示还没开始</span></span><br><span class="line">        String remainNum = jedis.get(remainNumKey);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (remainNum == <span class="keyword">null</span>)&#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;秒杀还没开始！&quot;</span>);</span><br><span class="line">            jedis.close();</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 6、判断用户是否重复秒杀</span></span><br><span class="line">        <span class="keyword">if</span>(jedis.sismember(userKey, uid))&#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;已经秒杀成功，不能重复秒杀&quot;</span>);</span><br><span class="line">            jedis.close();</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 7、判断如果商品数量、库存小于1，秒杀结束</span></span><br><span class="line">        <span class="keyword">if</span> (Integer.parseInt(remainNum) &lt; <span class="number">1</span>)&#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;秒杀已经结束！&quot;</span>);</span><br><span class="line">            jedis.close();</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 开启事务</span></span><br><span class="line">        Transcation multi = jedis.multi();</span><br><span class="line">       </span><br><span class="line">        <span class="comment">// 秒杀过程，库存减一，把用户添加到名单里</span></span><br><span class="line">        multi.decr(remainNumKey);</span><br><span class="line">        multi.sadd(userKey,uid);</span><br><span class="line">        List&lt;Object&gt; rst = multi.exec();</span><br><span class="line">        <span class="keyword">if</span>(rst==<span class="keyword">null</span> || rst.size()==<span class="number">0</span>)&#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;秒杀失败！&quot;</span>);</span><br><span class="line">            jedis.close();</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        System.out.println(<span class="string">&quot;秒杀成功！&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>









<h1 id="九、Redis-的持久化"><a href="#九、Redis-的持久化" class="headerlink" title="九、Redis 的持久化"></a>九、Redis 的持久化</h1><p>Redis 中的持久化操作分为：</p>
<ul>
<li>RDB</li>
<li>AOF</li>
</ul>
<h2 id="1、RDB"><a href="#1、RDB" class="headerlink" title="1、RDB"></a>1、RDB</h2><p>RDB 就是在指定的<font style="color:red;">时间间隔</font>内，将内存中的<font style="color:red;">数据集快照</font>写入磁盘，也就是<code>Snapshot 快照</code>，它回复时是将快照文件直接读到内存中。（每隔一段时间，就将内存数据写入磁盘）</p>
<p>如何备份：</p>
<blockquote>
<ul>
<li>Redis 会单独创建（fork）一个子进程来进行持久化</li>
<li>先将数据写入<strong>临时文件</strong>，等到出啊结束后，再用<strong>临时文件替换上一次的持久化文件</strong>。</li>
<li>主进程不会有<code>I/O 操作</code>，确保了性能</li>
<li>RDB 比 AOF 更高效。</li>
<li>缺点：<strong>最后一次持久化的数据可能丢失</strong>。</li>
</ul>
</blockquote>
<p>。。。。。。</p>
<h2 id="2、AOP"><a href="#2、AOP" class="headerlink" title="2、AOP"></a>2、AOP</h2><p>。。。。。。。。。。</p>
<h1 id="报错解决"><a href="#报错解决" class="headerlink" title="报错解决"></a>报错解决</h1><h2 id="1、Redis—-error-MISCONF"><a href="#1、Redis—-error-MISCONF" class="headerlink" title="1、Redis—-(error) MISCONF"></a>1、Redis—-(error) MISCONF</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">错误：Redis----(error) MISCONF Redis is configured to save RDB snapshots</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">解决方案：</span><br><span class="line"></span><br><span class="line">直接修改redis.conf配置文件，但是更改后需要重启redis。</span><br><span class="line">修改redis.conf文件：</span><br><span class="line"></span><br><span class="line">（1）vim打开redis-server配置的redis.conf文件，</span><br><span class="line">（2）使用快捷匹配模式：</span><br><span class="line">/stop-writes-on-bgsave-error定位到stop-writes-on-bgsave-error字符串所在位置，</span><br><span class="line">（3）把后面的yes设置为no。</span><br></pre></td></tr></table></figure>





<h2 id="2、解决SpringSecurity的自定义认证过滤器中无法注入-RedisTemplate的问题"><a href="#2、解决SpringSecurity的自定义认证过滤器中无法注入-RedisTemplate的问题" class="headerlink" title="2、解决SpringSecurity的自定义认证过滤器中无法注入 RedisTemplate的问题"></a>2、解决SpringSecurity的自定义认证过滤器中无法注入 RedisTemplate的问题</h2><p><a target="_blank" rel="noopener" href="https://blog.csdn.net/weixin_48568302/article/details/124429745">解决SpringBoot项目，过滤器中注入redisTemplate(方案一)</a></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">RedisBean</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> RedisTemplate redisTemplate;</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> RedisTemplate redis;</span><br><span class="line">    <span class="meta">@PostConstruct</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">getRedisTemplate</span><span class="params">()</span></span>&#123;</span><br><span class="line">        redis=<span class="keyword">this</span>.redisTemplate;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="mailto:undefined">CYW</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="http://cder123.github.io/2022/03/03/Redis-%E7%AC%94%E8%AE%B0/">http://cder123.github.io/2022/03/03/Redis-笔记/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="http://cder123.github.io" target="_blank">Cyw的笔记栈</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/Redis/">Redis</a></div><div class="post_share"><div class="social-share" data-image="https://z3.ax1x.com/2021/06/01/2KV1yj.png" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/social-share.js/dist/js/social-share.min.js" defer></script></div></div><div class="post-reward"><div class="reward-button button--animated"><i class="fas fa-qrcode"></i> 打赏</div><div class="reward-main"><ul class="reward-all"><li class="reward-item"><a href="/img/qrcode_for_wx_gongzhonghao.jpg" target="_blank"><img class="post-qr-code-img" src= "data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="/img/qrcode_for_wx_gongzhonghao.jpg" alt="微信订阅号"/></a><div class="post-qr-code-desc">微信订阅号</div></li></ul></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/2022/03/03/Python-%E8%AF%BE%E5%A0%82%E7%AC%94%E8%AE%B0/"><img class="prev-cover" src= "data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="https://z3.ax1x.com/2021/06/01/2KV1yj.png" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">Python—课堂笔记</div></div></a></div><div class="next-post pull-right"><a href="/2022/02/15/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/"><img class="next-cover" src= "data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="https://z3.ax1x.com/2021/06/01/2KV1yj.png" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">设计模式</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span> 相关推荐</span></div><div class="relatedPosts-list"><div><a href="/2022/02/07/Redis-入门笔记/" title="Redis-入门笔记"><img class="cover" src= "data:image/gif;base64,R0lGODdhAQABAPAAAMPDwwAAACwAAAAAAQABAAACAkQBADs=" data-lazy-src="https://z3.ax1x.com/2021/06/01/2KV1yj.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-02-07</div><div class="title">Redis-入门笔记</div></div></a></div></div></div></div><div class="aside-content" id="aside-content"><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link"><span class="toc-text">Redis-笔记</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E9%9B%B6%E3%80%81%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99"><span class="toc-text">零、参考资料</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%B8%80%E3%80%81Redis-%E7%9A%84%E5%AE%89%E8%A3%85"><span class="toc-text">一、Redis 的安装</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1%E3%80%81%E5%AE%89%E8%A3%85%E6%AD%A5%E9%AA%A4"><span class="toc-text">1、安装步骤</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2%E3%80%81%E5%AE%89%E8%A3%85%E8%BF%87%E7%A8%8B%E4%B8%AD%E5%8F%AF%E8%83%BD%E5%87%BA%E7%8E%B0%E7%9A%84%E6%8A%A5%E9%94%99"><span class="toc-text">2、安装过程中可能出现的报错</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3%E3%80%81Redis-%E5%AE%89%E8%A3%85%E7%9B%AE%E5%BD%95%E4%BB%8B%E7%BB%8D"><span class="toc-text">3、Redis 安装目录介绍</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4%E3%80%81Redis-%E5%90%AF%E5%8A%A8%E6%9C%8D%E5%8A%A1%E7%AB%AF%E6%AD%A5%E9%AA%A4"><span class="toc-text">4、Redis 启动服务端步骤</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5%E3%80%81Redis-%E5%90%AF%E5%8A%A8%E5%AE%A2%E6%88%B7%E7%AB%AF%E6%AD%A5%E9%AA%A4"><span class="toc-text">5、Redis 启动客户端步骤</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#6%E3%80%81Redis-%E5%85%B3%E9%97%AD%E5%AE%A2%E6%88%B7%E7%AB%AF%E6%AD%A5%E9%AA%A4"><span class="toc-text">6、Redis 关闭客户端步骤</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#7%E3%80%81Redis-%E7%9B%B8%E5%85%B3%E7%9F%A5%E8%AF%86%E7%9A%84%E4%BB%8B%E7%BB%8D"><span class="toc-text">7、Redis 相关知识的介绍</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%BA%8C%E3%80%81Redis-%E5%B8%B8%E7%94%A8%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B"><span class="toc-text">二、Redis 常用数据类型</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1%E3%80%81%E9%80%9A%E7%94%A8%E7%9A%84%E6%93%8D%E4%BD%9C"><span class="toc-text">1、通用的操作</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2%E3%80%81string-%E7%B1%BB%E5%9E%8B"><span class="toc-text">2、string 类型</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3%E3%80%81list-%E7%B1%BB%E5%9E%8B"><span class="toc-text">3、list 类型</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4%E3%80%81set-%E7%B1%BB%E5%9E%8B"><span class="toc-text">4、set 类型</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5%E3%80%81hash-%E7%B1%BB%E5%9E%8B"><span class="toc-text">5、hash 类型</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#6%E3%80%81zset-%E7%B1%BB%E5%9E%8B"><span class="toc-text">6、zset 类型</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#7%E3%80%81bitmaps-%E7%B1%BB%E5%9E%8B"><span class="toc-text">7、bitmaps 类型</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#8%E3%80%81hyperloglog-%E7%B1%BB%E5%9E%8B"><span class="toc-text">8、hyperloglog 类型</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#9%E3%80%81geospatial-%E7%B1%BB%E5%9E%8B"><span class="toc-text">9、geospatial 类型</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%B8%89%E3%80%81Redis-%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6"><span class="toc-text">三、Redis 配置文件</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#0%E3%80%81%E5%B8%B8%E7%94%A8%E8%AE%BE%E7%BD%AE"><span class="toc-text">0、常用设置</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#1%E3%80%81units-%E5%8D%95%E4%BD%8D"><span class="toc-text">1、units 单位</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2%E3%80%81include-%E5%BC%95%E5%85%A5%E5%85%B6%E4%BB%96%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6"><span class="toc-text">2、include 引入其他配置文件</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3%E3%80%81network-%E7%BD%91%E7%BB%9C%E8%AE%BE%E7%BD%AE"><span class="toc-text">3、network 网络设置</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#3-1%E3%80%81bind-%E7%BB%91%E5%AE%9A-IP-%E5%9C%B0%E5%9D%80"><span class="toc-text">3.1、bind 绑定 IP 地址</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-2%E3%80%81protected-mode-%E6%98%AF%E5%90%A6%E5%85%81%E8%AE%B8%E8%BF%9C%E7%A8%8B%E8%AE%BF%E9%97%AE"><span class="toc-text">3.2、protected-mode 是否允许远程访问</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-3%E3%80%81port-%E6%9C%8D%E5%8A%A1%E7%9B%91%E5%90%AC%E7%9A%84%E7%AB%AF%E5%8F%A3"><span class="toc-text">3.3、port 服务监听的端口</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-4%E3%80%81-tcp-backlog-%E8%BF%9E%E6%8E%A5%E9%98%9F%E5%88%97"><span class="toc-text">3.4、 tcp-backlog 连接队列</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-5%E3%80%81-time-out-%E8%B6%85%E6%97%B6"><span class="toc-text">3.5、 time-out 超时</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-6%E3%80%81tcp-keepalive"><span class="toc-text">3.6、tcp-keepalive</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4%E3%80%81general-%E9%80%9A%E7%94%A8%E9%85%8D%E7%BD%AE"><span class="toc-text">4、general 通用配置</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#4-1%E3%80%81daemon-%E5%90%8E%E5%8F%B0%E5%90%AF%E5%8A%A8"><span class="toc-text">4.1、daemon 后台启动</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-2%E3%80%81pidfile-%E6%96%87%E4%BB%B6"><span class="toc-text">4.2、pidfile 文件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-3%E3%80%81loglevel-%E6%97%A5%E5%BF%97%E7%AD%89%E7%BA%A7"><span class="toc-text">4.3、loglevel 日志等级</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-4%E3%80%81database-%E9%BB%98%E8%AE%A4%E7%9A%84%E6%95%B0%E6%8D%AE%E5%BA%93%E6%95%B0"><span class="toc-text">4.4、database 默认的数据库数</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5%E3%80%81security-%E5%AE%89%E5%85%A8"><span class="toc-text">5、security 安全</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#5-1%E3%80%81%E8%AE%BE%E7%BD%AE%E5%AF%86%E7%A0%81"><span class="toc-text">5.1、设置密码</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#6%E3%80%81limit-%E9%99%90%E5%88%B6"><span class="toc-text">6、limit 限制</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#6-1%E3%80%81maxclients-%E6%9C%80%E5%A4%A7%E5%AE%A2%E6%88%B7%E7%AB%AF%E8%BF%9E%E6%8E%A5%E6%95%B0"><span class="toc-text">6.1、maxclients 最大客户端连接数</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-2%E3%80%81maxmemory-%E6%9C%80%E5%A4%A7%E5%86%85%E5%AD%98"><span class="toc-text">6.2、maxmemory 最大内存</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%9B%9B%E3%80%81%E8%AE%A2%E9%98%85%E4%B8%8E%E5%8F%91%E5%B8%83"><span class="toc-text">四、订阅与发布</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1%E3%80%81%E4%BB%80%E4%B9%88%E6%98%AF%E8%AE%A2%E9%98%85%E5%92%8C%E5%8F%91%E5%B8%83"><span class="toc-text">1、什么是订阅和发布</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2%E3%80%81%E8%AE%A2%E9%98%85%E4%B8%8E%E5%8F%91%E5%B8%83%E7%9A%84%E5%AE%9E%E7%8E%B0%E6%A1%88%E4%BE%8B"><span class="toc-text">2、订阅与发布的实现案例</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#2-1%E3%80%81Redis-%E5%AE%A2%E6%88%B7%E7%AB%AF1-%E8%AE%A2%E9%98%85%E9%A2%91%E9%81%93"><span class="toc-text">2.1、Redis 客户端1 订阅频道</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-2%E3%80%81Redis-%E5%AE%A2%E6%88%B7%E7%AB%AF2-%E5%8F%91%E5%B8%83%E6%B6%88%E6%81%AF"><span class="toc-text">2.2、Redis 客户端2 发布消息</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-2%E3%80%81Redis-%E5%AE%A2%E6%88%B7%E7%AB%AF1-%E6%8E%A5%E6%94%B6%E6%B6%88%E6%81%AF"><span class="toc-text">2.2、Redis 客户端1 接收消息</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%BA%94%E3%80%81Jedis-%E6%93%8D%E4%BD%9C"><span class="toc-text">五、Jedis 操作</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1%E3%80%81Maven-%E4%BE%9D%E8%B5%96"><span class="toc-text">1、Maven 依赖</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2%E3%80%81Jedis-%E7%9A%84%E8%BF%9E%E9%80%9A"><span class="toc-text">2、Jedis 的连通</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3%E3%80%81Jedis-%E7%9A%84-API-keys"><span class="toc-text">3、Jedis 的 API-keys</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4%E3%80%81Jedis-%E7%9A%84-API-String"><span class="toc-text">4、Jedis 的 API-String</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%85%AD%E3%80%81%E6%A1%88%E4%BE%8B-%E6%A8%A1%E6%8B%9F%E6%89%8B%E6%9C%BA%E9%AA%8C%E8%AF%81%E7%A0%81"><span class="toc-text">六、案例-模拟手机验证码</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1%E3%80%81%E8%A6%81%E6%B1%82"><span class="toc-text">1、要求</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2%E3%80%81%E5%AE%9E%E7%8E%B0%E6%80%9D%E8%B7%AF"><span class="toc-text">2、实现思路</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3%E3%80%81%E5%AE%9E%E7%8E%B0"><span class="toc-text">3、实现</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#3-1%E3%80%81%E7%94%9F%E6%88%90%E9%AA%8C%E8%AF%81%E7%A0%81"><span class="toc-text">3.1、生成验证码</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-2%E3%80%81%E9%99%90%E5%88%B6%E6%AF%8F%E4%B8%AA%E6%89%8B%E6%9C%BA%E6%AF%8F%E5%A4%A9%E5%8F%AA%E8%83%BD%E5%8F%91%E9%80%81%E4%B8%89%E6%AC%A1"><span class="toc-text">3.2、限制每个手机每天只能发送三次</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-3%E3%80%81%E6%A0%A1%E9%AA%8C%E9%AA%8C%E8%AF%81%E7%A0%81"><span class="toc-text">3.3、校验验证码</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-4%E3%80%81%E6%B5%8B%E8%AF%95"><span class="toc-text">3.4、测试</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-5%E3%80%81%E5%AE%8C%E6%95%B4%E7%89%88%E4%BB%A3%E7%A0%81"><span class="toc-text">3.5、完整版代码</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%B8%83%E3%80%81Redis-%E6%95%B4%E5%90%88-SpringBoot"><span class="toc-text">七、Redis 整合 SpringBoot</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1%E3%80%81Maven%E4%BE%9D%E8%B5%96"><span class="toc-text">1、Maven依赖</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2%E3%80%81SpringBoot-%E7%9A%84%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%E4%B8%AD%E7%9A%84-Redis-%E9%83%A8%E5%88%86"><span class="toc-text">2、SpringBoot 的配置文件中的 Redis 部分</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3%E3%80%81SpringBoot-%E7%9A%84-Redis-%E9%85%8D%E7%BD%AE%E7%B1%BB"><span class="toc-text">3、SpringBoot 的 Redis 配置类</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4%E3%80%81%E6%B5%8B%E8%AF%95%E7%B1%BB"><span class="toc-text">4、测试类</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%85%AB%E3%80%81%E4%BA%8B%E5%8A%A1-%E4%B8%8E-%E9%94%81%E6%9C%BA%E5%88%B6"><span class="toc-text">八、事务 与 锁机制</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1%E3%80%81%E5%9F%BA%E6%9C%AC%E6%93%8D%E4%BD%9C"><span class="toc-text">1、基本操作</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2%E3%80%81%E4%BA%8B%E5%8A%A1%E7%9A%84%E9%94%99%E8%AF%AF%E5%A4%84%E7%90%86"><span class="toc-text">2、事务的错误处理</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#2-1%E3%80%81%E7%BB%84%E9%98%9F%E5%87%BA%E9%94%99"><span class="toc-text">2.1、组队出错</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-2%E3%80%81%E6%89%A7%E8%A1%8C%E5%87%BA%E9%94%99"><span class="toc-text">2.2、执行出错</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3%E3%80%81%E6%82%B2%E8%A7%82%E9%94%81"><span class="toc-text">3、悲观锁</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4%E3%80%81%E4%B9%90%E8%A7%82%E9%94%81"><span class="toc-text">4、乐观锁</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5%E3%80%81Redis-%E4%BA%8B%E5%8A%A1%E7%9A%84%E4%B8%89%E4%B8%AA%E7%89%B9%E6%80%A7"><span class="toc-text">5、Redis 事务的三个特性</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#6%E3%80%81%E6%A1%88%E4%BE%8B-%E7%A7%92%E6%9D%80"><span class="toc-text">6、案例-秒杀</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#7%E3%80%81ab%E5%B7%A5%E5%85%B7%E6%A8%A1%E6%8B%9F%E5%B9%B6%E5%8F%91"><span class="toc-text">7、ab工具模拟并发</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%B9%9D%E3%80%81Redis-%E7%9A%84%E6%8C%81%E4%B9%85%E5%8C%96"><span class="toc-text">九、Redis 的持久化</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1%E3%80%81RDB"><span class="toc-text">1、RDB</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2%E3%80%81AOP"><span class="toc-text">2、AOP</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%8A%A5%E9%94%99%E8%A7%A3%E5%86%B3"><span class="toc-text">报错解决</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1%E3%80%81Redis%E2%80%94-error-MISCONF"><span class="toc-text">1、Redis—-(error) MISCONF</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2%E3%80%81%E8%A7%A3%E5%86%B3SpringSecurity%E7%9A%84%E8%87%AA%E5%AE%9A%E4%B9%89%E8%AE%A4%E8%AF%81%E8%BF%87%E6%BB%A4%E5%99%A8%E4%B8%AD%E6%97%A0%E6%B3%95%E6%B3%A8%E5%85%A5-RedisTemplate%E7%9A%84%E9%97%AE%E9%A2%98"><span class="toc-text">2、解决SpringSecurity的自定义认证过滤器中无法注入 RedisTemplate的问题</span></a></li></ol></li></ol></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div class="copyright">&copy;2021 - 2022 By CYW</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="font-plus" type="button" title="放大字体"><i class="fas fa-plus"></i></button><button id="font-minus" type="button" title="缩小字体"><i class="fas fa-minus"></i></button><button id="translateLink" type="button" title="简繁转换">简</button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="回到顶部"><i class="fas fa-arrow-up"></i></button></div></div><div id="local-search"><div class="search-dialog"><div class="search-dialog__title" id="local-search-title">本地搜索</div><div id="local-input-panel"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"/></div></div></div><hr/><div id="local-search-results"></div><span class="search-close-button"><i class="fas fa-times"></i></span></div><div id="search-mask"></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><script src="https://cdn.jsdelivr.net/npm/medium-zoom/dist/medium-zoom.min.js"></script><script src="https://cdn.jsdelivr.net/npm/instant.page/instantpage.min.js" type="module"></script><script src="https://cdn.jsdelivr.net/npm/vanilla-lazyload/dist/lazyload.iife.min.js"></script><script src="/js/search/local-search.js"></script><div class="js-pjax"></div><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/dist/activate-power-mode.min.js"></script><script>POWERMODE.colorful = true;
POWERMODE.shake = true;
POWERMODE.mobile = false;
document.body.addEventListener('input', POWERMODE);
</script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></body></html>